# Uni-Converter è®¢é˜…è½¬æ¢å™¨

ä¸€ä¸ªèåˆäº†å‰åç«¯çš„è®¢é˜…è½¬æ¢æœåŠ¡ï¼ŒåŸºäº subconverter åç«¯å’Œ sub-web å‰ç«¯æ„å»ºçš„ Docker é•œåƒã€‚

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

Uni-Converter æ˜¯ä¸€ä¸ªè®¢é˜…è½¬æ¢æœåŠ¡ï¼Œå¯ä»¥å°†å„ç§æ ¼å¼çš„è®¢é˜…é“¾æ¥è½¬æ¢ä¸ºä¸åŒçš„å®¢æˆ·ç«¯é…ç½®æ ¼å¼ï¼ˆå¦‚ Clashã€V2Rayã€Surge ç­‰ï¼‰ã€‚è¿™ä¸ªé¡¹ç›®å°† subconverter åç«¯å’Œ sub-web å‰ç«¯èåˆåˆ°ä¸€ä¸ª Docker å®¹å™¨ä¸­ï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œä½¿ç”¨ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```mermaid
graph TB
    A["ç”¨æˆ·è¯·æ±‚"] --> B["Nginx (ç«¯å£ 80)"]
    B --> C{"è¯·æ±‚ç±»å‹åˆ¤æ–­"}
    C -->|å‰ç«¯é™æ€æ–‡ä»¶| D["sub-web å‰ç«¯<br/>(/var/www/html)"]
    C -->|åç«¯ API è¯·æ±‚| E["åå‘ä»£ç†<br/>(/sub, /api, /convert ç­‰)"]
    E --> F["subconverter åç«¯<br/>(ç«¯å£ 25500)"]
    G["Supervisor"] --> B
    G --> F
    H["Docker å®¹å™¨"] --> G
```

### æ¶æ„è¯´æ˜

1. **å‰ç«¯æœåŠ¡ (sub-web)**
   - æä¾› Web ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œè®¢é˜…è½¬æ¢æ“ä½œ
   - é™æ€æ–‡ä»¶å­˜å‚¨åœ¨ `/var/www/html` ç›®å½•
   - é€šè¿‡ Nginx æä¾› HTTP æœåŠ¡

2. **åç«¯æœåŠ¡ (subconverter)**
   - æä¾›è®¢é˜…è½¬æ¢çš„ API æ¥å£
   - ç›‘å¬å†…éƒ¨ç«¯å£ 25500
   - æ”¯æŒå¤šç§è®¢é˜…æ ¼å¼è½¬æ¢ï¼ˆClashã€V2Rayã€Surgeã€SSã€SSRã€Trojan ç­‰ï¼‰

3. **Nginx åå‘ä»£ç†**
   - ç›‘å¬ 80 ç«¯å£ï¼Œå¯¹å¤–æä¾›æœåŠ¡
   - å‰ç«¯è¯·æ±‚ç›´æ¥è¿”å›é™æ€æ–‡ä»¶
   - åç«¯ API è¯·æ±‚ï¼ˆå¦‚ `/sub`ã€`/api`ã€`/convert` ç­‰è·¯å¾„ï¼‰åå‘ä»£ç†åˆ° subconverter åç«¯

4. **Supervisor è¿›ç¨‹ç®¡ç†**
   - åŒæ—¶ç®¡ç† Nginx å’Œ subconverter ä¸¤ä¸ªæœåŠ¡
   - è‡ªåŠ¨é‡å¯å´©æºƒçš„æœåŠ¡
   - ç»Ÿä¸€æ—¥å¿—ç®¡ç†

## ğŸ“¦ æ–‡ä»¶è¯´æ˜

- `Dockerfile` - Docker é•œåƒæ„å»ºæ–‡ä»¶ï¼Œä½¿ç”¨å¤šé˜¶æ®µæ„å»º
- `nginx.conf` - Nginx é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰åå‘ä»£ç†è§„åˆ™
- `supervisord.conf` - Supervisor é…ç½®æ–‡ä»¶ï¼Œç®¡ç†æœåŠ¡è¿›ç¨‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker å·²å®‰è£…å¹¶è¿è¡Œ
- è‡³å°‘ 2GB å¯ç”¨ç£ç›˜ç©ºé—´

### æ„å»ºé•œåƒ

åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º Docker é•œåƒï¼š

```bash
docker build -t uni-converter:latest .
```

æ„å»ºè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œå› ä¸ºéœ€è¦ï¼š
1. ä¸‹è½½å¹¶æ„å»ºå‰ç«¯ï¼ˆsub-webï¼‰
2. ä¸‹è½½åç«¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆsubconverterï¼‰
3. å®‰è£…è¿è¡Œæ—¶ä¾èµ–

### è¿è¡Œå®¹å™¨

æ„å»ºå®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®¹å™¨ï¼š

```bash
docker run -d \
  --name uni-converter \
  --restart=unless-stopped \
  -p 8080:80 \
  uni-converter:latest
```

å‚æ•°è¯´æ˜ï¼š
- `-d`: åå°è¿è¡Œ
- `--name uni-converter`: å®¹å™¨åç§°
- `--restart=unless-stopped`: è‡ªåŠ¨é‡å¯ç­–ç•¥
- `-p 8080:80`: ç«¯å£æ˜ å°„ï¼Œå°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£

### è®¿é—®æœåŠ¡

å®¹å™¨å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://localhost:8080
- **åç«¯ API**: http://localhost:8080/sub?target=clash&url=è®¢é˜…é“¾æ¥

## ğŸ”§ é…ç½®è¯´æ˜

### ä¿®æ”¹ç«¯å£

å¦‚æœéœ€è¦ä¿®æ”¹æ˜ å°„ç«¯å£ï¼Œä¿®æ”¹ `-p` å‚æ•°å³å¯ï¼š

```bash
docker run -d \
  --name uni-converter \
  --restart=unless-stopped \
  -p 3000:80 \
  uni-converter:latest
```

### è‡ªå®šä¹‰ Nginx é…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹ Nginx é…ç½®ï¼Œå¯ä»¥ï¼š

1. ç¼–è¾‘ `nginx.conf` æ–‡ä»¶
2. é‡æ–°æ„å»ºé•œåƒ
3. æˆ–è€…é€šè¿‡æŒ‚è½½å·çš„æ–¹å¼è¦†ç›–é…ç½®æ–‡ä»¶ï¼š

```bash
docker run -d \
  --name uni-converter \
  --restart=unless-stopped \
  -p 8080:80 \
  -v /path/to/your/nginx.conf:/etc/nginx/sites-available/uni-converter \
  uni-converter:latest
```

### æŒä¹…åŒ–é…ç½®

subconverter çš„é…ç½®æ–‡ä»¶ä½äº `/app/subconverter/config` ç›®å½•ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–é…ç½®ï¼Œå¯ä»¥æŒ‚è½½è¯¥ç›®å½•ï¼š

```bash
docker run -d \
  --name uni-converter \
  --restart=unless-stopped \
  -p 8080:80 \
  -v /path/to/config:/app/subconverter/config \
  uni-converter:latest
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### é€šè¿‡å‰ç«¯ç•Œé¢ä½¿ç”¨

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8080
2. åœ¨ç•Œé¢ä¸­è¾“å…¥è®¢é˜…é“¾æ¥
3. é€‰æ‹©ç›®æ ‡æ ¼å¼ï¼ˆå¦‚ Clashã€V2Ray ç­‰ï¼‰
4. ç‚¹å‡»è½¬æ¢æŒ‰é’®
5. å¤åˆ¶ç”Ÿæˆçš„è®¢é˜…é“¾æ¥

### é€šè¿‡ API ç›´æ¥ä½¿ç”¨

```bash
# è½¬æ¢ä¸º Clash æ ¼å¼
curl "http://localhost:8080/sub?target=clash&url=ä½ çš„è®¢é˜…é“¾æ¥"

# è½¬æ¢ä¸º V2Ray æ ¼å¼
curl "http://localhost:8080/sub?target=v2ray&url=ä½ çš„è®¢é˜…é“¾æ¥"

# è½¬æ¢ä¸º Surge æ ¼å¼
curl "http://localhost:8080/sub?target=surge&url=ä½ çš„è®¢é˜…é“¾æ¥"
```

## ğŸ” æ•…éšœæ’æŸ¥

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker logs uni-converter

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f uni-converter
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

è¿›å…¥å®¹å™¨æŸ¥çœ‹ Supervisor ç®¡ç†çš„æœåŠ¡çŠ¶æ€ï¼š

```bash
docker exec uni-converter supervisorctl status
```

åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªæœåŠ¡éƒ½åœ¨è¿è¡Œï¼š
- `nginx`: RUNNING
- `subconverter`: RUNNING

### æ£€æŸ¥ç«¯å£å ç”¨

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š
```bash
lsof -i :8080
```

2. æˆ–è€…ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š
```bash
docker run -d \
  --name uni-converter \
  --restart=unless-stopped \
  -p 8081:80 \
  uni-converter:latest
```

### é‡å¯å®¹å™¨

```bash
docker restart uni-converter
```

### åœæ­¢å¹¶åˆ é™¤å®¹å™¨

```bash
docker stop uni-converter
docker rm uni-converter
```

## ğŸ“š ä¾èµ–è¯´æ˜

### æ„å»ºæ—¶ä¾èµ–

- **Node.js 18**: ç”¨äºæ„å»ºå‰ç«¯ï¼ˆsub-webï¼‰
- **Ubuntu 22.04**: è¿è¡Œç¯å¢ƒåŸºç¡€é•œåƒ
- **Nginx**: Web æœåŠ¡å™¨å’Œåå‘ä»£ç†
- **Supervisor**: è¿›ç¨‹ç®¡ç†å·¥å…·

### è¿è¡Œæ—¶ä¾èµ–

- **libcurl4**: HTTP å®¢æˆ·ç«¯åº“
- **libssl3**: SSL/TLS æ”¯æŒ
- **ca-certificates**: CA è¯ä¹¦

### å¤–éƒ¨æœåŠ¡

- **GitHub**: ä¸‹è½½ sub-web å‰ç«¯æºç å’Œ subconverter åç«¯äºŒè¿›åˆ¶æ–‡ä»¶

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡æ„å»ºæ—¶é—´è¾ƒé•¿**: å› ä¸ºéœ€è¦ä¸‹è½½å’Œæ„å»ºå‰ç«¯ï¼Œé¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ
2. **ç«¯å£å†²çª**: ç¡®ä¿æ˜ å°„çš„ç«¯å£æ²¡æœ‰è¢«å…¶ä»–æœåŠ¡å ç”¨
3. **ç½‘ç»œè¿æ¥**: æ„å»ºæ—¶éœ€è¦èƒ½å¤Ÿè®¿é—® GitHub ä¸‹è½½æºç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶
4. **èµ„æºæ¶ˆè€—**: å»ºè®®è‡³å°‘åˆ†é… 512MB å†…å­˜ç»™å®¹å™¨
5. **é…ç½®æŒä¹…åŒ–**: å¦‚æœéœ€è¦è‡ªå®šä¹‰ subconverter é…ç½®ï¼Œè®°å¾—æŒ‚è½½é…ç½®ç›®å½•

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### ä¿®æ”¹å‰ç«¯

å¦‚æœéœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç ï¼š

1. ä¿®æ”¹ `Dockerfile` ä¸­çš„å‰ç«¯æ„å»ºéƒ¨åˆ†
2. é‡æ–°æ„å»ºé•œåƒ

### ä¿®æ”¹åç«¯é…ç½®

subconverter çš„é…ç½®æ–‡ä»¶ä½äºå®¹å™¨å†…çš„ `/app/subconverter/config` ç›®å½•ï¼Œå¯ä»¥é€šè¿‡æŒ‚è½½å·çš„æ–¹å¼ä¿®æ”¹ã€‚

### æ›´æ–°ç‰ˆæœ¬

è¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

1. åˆ é™¤æ—§é•œåƒå’Œå®¹å™¨
2. é‡æ–°æ„å»ºé•œåƒï¼ˆä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼‰
3. å¯åŠ¨æ–°å®¹å™¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [subconverter](https://github.com/tindy2013/subconverter) - åç«¯è½¬æ¢æœåŠ¡
- [sub-web](https://github.com/CareyWang/sub-web) - å‰ç«¯ç•Œé¢

è¯·å‚è€ƒå„è‡ªé¡¹ç›®çš„è®¸å¯è¯è¯´æ˜ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—æˆ–æäº¤ Issue å¯»æ±‚å¸®åŠ©ã€‚

